<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="admin_dashboard.css" />
</head>
<body>

  <!-- Sticky Top Tab with Wallpaper Background -->
  <div class="top-tab">
    <span class="tab-title">Welcome ADMIN!</span>
    <button class="signout-button" onclick="signOut()">Sign Out</button>
  </div>

<!-- DASHBOARD BOXES -->
<div class="dashboard-boxes">
  <div class="dashboard-box">
    <div class="box-icon"></div>
    <div class="box-label">Rooms Vacant</div>
  </div>
  <div class="dashboard-box">
    <div class="box-icon"></div>
    <div class="box-label">Devices Online</div>
  </div>
  <div class="dashboard-box">
    <div class="box-icon"></div>
    <div class="box-label">Maintenance</div>
  </div>
  <div class="dashboard-box">
    <div class="box-icon"></div>
    <div class="box-label">Notes & Tagging</div>
  </div>
</div>

<!-- MAIN CONFIGURATION PANEL -->
<div class="configuration-panel">
  <!-- LEFT SIDE -->
  <div class="left-panel">
    <h1>Upload Static Map</h1>
    <div class="map-container">
      <div class="map-placeholder" onclick="document.getElementById('mapUpload').click()">
        <span id="placeholderText">Click to upload static map</span>
        <img id="mapImage" src="" alt="" style="display: none;" />
      </div>
      <input type="file" id="mapUpload" accept="image/*" onchange="handleImageUpload(event)">
      <div class="instruction">Only image files are allowed (e.g., JPG, PNG).</div>
    </div>
  </div>

  <!-- RIGHT SIDE -->
  <div class="right-panel">
    <button class="button" onclick="openCampusModal()">Configure Campuses</button>
    <button class="button" onclick="openModal()">Configure Room & Building</button>
    <div class="building-toggle">
      <div class="building-header" onclick="toggleBuildingList()">View Configured Buildings</div>
      <div class="building-list" id="buildingList"></div>
      <button class="button" style="margin-top: 10px;" onclick="toggleCampusList()">View Campuses</button>
      <div id="campusList" style="margin-top: 15px; color: #046013; font-weight: bold; display: none;"></div>
    </div>
  </div>
</div>

<!-- CAMPUS CONFIGURATION MODAL -->
<div id="campusModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeCampusModal()">&times;</span>
    <h2>Configure Campus</h2>
    <label>Campus Name:</label>
    <input type="text" id="campusName" placeholder="Enter campus name" />
    <label>Campus Address:</label>
    <input type="text" id="campusAddress" placeholder="Enter campus address" />
    <button onclick="saveCampus()">Save Campus</button>
  </div>
</div>


<!-- MODAL POPUP -->
<div id="configModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Configure Building</h2>

    <label>Select Campus:</label>
    <select id="campusDropdown" onchange="handleCampusChange()">
      <option value="no-campus" selected disabled>Select a campus</option>
      <!-- Campus options will be populated dynamically -->
    </select>

    <label>Building Name:</label>
    <input type="text" id="buildName" placeholder="Enter Building name" />

    <label>Number of Floors:</label>
    <input type="number" id="floorCount" placeholder="Enter number of floors" />

    <button id="saveBuildingBtn" onclick="saveConfiguration()" disabled>Save</button>
  </div>
</div>


<script>

const buildingData = {}; //building list
const campusData = {}; // campus list

//data list is set to fasle (not visible)
let isBuildingListVisible = false;
let isCampusListVisible = false;

//opens the dialog box for room & building
function openModal() {
  populateCampusDropdown(); // Load campuses into dropdown
  document.getElementById("configModal").style.display = "block";
}
//closes the dialog box for room and building
function closeModal() {
  document.getElementById("configModal").style.display = "none";
}
//opens the dialog box for configure campuses
function openCampusModal(){
  document.getElementById("campusModal").style.display = "block";
}
//close the dialog box for configure campuses
function closeCampusModal(){
  document.getElementById("campusModal").style.display = "none";
}

function handleCampusChange() {
  const dropdown = document.getElementById("campusDropdown");
  const saveBtn = document.getElementById("saveBuildingBtn");
  saveBtn.disabled = dropdown.value === "no-campus";
}

//saves the data of the newly added campus
function saveCampus(){
  const campus = document.getElementById("campusName").value.trim();
  const address = document.getElementById("campusAddress").value.trim();

  if (!campus || !address){ //campus and address has no inputs then alert
    alert("Please fill in both campus and address.");
    return;
  }

  campusData[campus] = address;
  updateCampusList();
  closeCampusModal();
  alert(`Campus "${campus}" saved successfully`);

  document.getElementById("campusName").value = "";
  document.getElementById("campusAddress").value = "";
}

function updateCampusList() {
  const listContainer = document.getElementById("campusList");
  listContainer.innerHTML = "<h3>Configured Campuses:</h3>";

  for (const campus in campusData) {
    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center";
    item.style.marginBottom = "5px";

    const text = document.createElement("span");
    text.textContent = `${campus} - ${campusData[campus]}`;

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.style.marginLeft = "10px";
    deleteBtn.style.padding = "2px 8px";
    deleteBtn.style.backgroundColor = "#e74c3c";
    deleteBtn.style.color = "#fff";
    deleteBtn.style.border = "none";
    deleteBtn.style.borderRadius = "4px";
    deleteBtn.style.cursor = "pointer";
    deleteBtn.onclick = function () {
      if (confirm(`Are you sure you want to delete the campus "${campus}"?`)) {
        delete campusData[campus];
        updateCampusList();
        alert(`Campus "${campus}" has been deleted.`);
      }
    };

    item.appendChild(text);
    item.appendChild(deleteBtn);
    listContainer.appendChild(item);
  }
}


function saveConfiguration() {
  const campusDropdown = document.getElementById("campusDropdown");
  const campus = campusDropdown.value;
  const building = document.getElementById("buildName").value.trim();
  const floor = parseInt(document.getElementById("floorCount").value);

  // Prevent saving if no campus is selected (placeholder has value "no-campus")
  if (!campus || campus === "no-campus") {
    alert("Please select a campus before saving the building.");
    return;
  }

  // Validate other fields
  if (!building || isNaN(floor) || floor <= 0) {
    alert("Please enter a valid building name and floor count.");
    return;
  }

  const buildingKey = `${campus} - ${building}`;
  buildingData[buildingKey] = floor;

  updateBuildingList();
  closeModal();
  alert(`Saved: ${buildingKey} with ${floor} floors`);

  // Reset form
  document.getElementById("buildName").value = "";
  document.getElementById("floorCount").value = "";
}

function updateBuildingList() {
  const listContainer = document.getElementById("buildingList");
  listContainer.innerHTML = "";

  for (const building in buildingData) {
    const item = document.createElement("div");
    item.className = "building-item";
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center";
    item.style.cursor = "pointer";
    item.style.marginBottom = "5px";

    const buildingText = document.createElement("span");
    buildingText.textContent = building;
    buildingText.onclick = function () {
      const floors = document.createElement("div");
      floors.className = "floor-list";
      floors.innerHTML = "";
      for (let i = 1; i <= buildingData[building]; i++) {
        const floor = document.createElement("div");
        floor.textContent = `Floor ${i}`;
        floors.appendChild(floor);
      }

      const existing = item.querySelector(".floor-list");
      if (existing) {
        existing.remove();
      } else {
        item.appendChild(floors);
      }
    };

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.style.marginLeft = "10px";
    deleteBtn.style.padding = "2px 8px";
    deleteBtn.style.backgroundColor = "#e74c3c";
    deleteBtn.style.color = "#fff";
    deleteBtn.style.border = "none";
    deleteBtn.style.borderRadius = "4px";
    deleteBtn.style.cursor = "pointer";

    deleteBtn.onclick = function (event) {
      event.stopPropagation(); // prevent triggering floor toggle
      if (confirm(`Are you sure you want to delete the building "${building}"?`)) {
        delete buildingData[building];
        updateBuildingList();
        alert(`Building "${building}" deleted.`);
      }
    };

    item.appendChild(buildingText);
    item.appendChild(deleteBtn);
    listContainer.appendChild(item);
  }
}


//SHOWS LIST OF EXISITNG BUILDINGS
function toggleBuildingList() {
  const list = document.getElementById("buildingList");
  isBuildingListVisible = !isBuildingListVisible;
  list.style.display = isBuildingListVisible ? "block" : "none";
}
//SHOWS LIST OF EXISITNG CAMPUSES
function toggleCampusList() {
  const list = document.getElementById("campusList");
  isCampusListVisible = !isCampusListVisible;
  list.style.display = isCampusListVisible ? "block" : "none";
}

//POPULATE DROPDOWN FOR CAMPUS SELECTION
function populateCampusDropdown() {
  const dropdown = document.getElementById("campusDropdown");
  const saveBtn = document.getElementById("saveBuildingBtn");
  dropdown.innerHTML = ""; // Clear old options

  const placeholder = document.createElement("option");
  placeholder.value = "no-campus";
  placeholder.textContent = "Select a campus";
  placeholder.disabled = true;
  placeholder.selected = true;
  dropdown.appendChild(placeholder);

  for (const campus in campusData) {
    const option = document.createElement("option");
    option.value = campus;
    option.textContent = campus;
    dropdown.appendChild(option);
  }

  // Initially disable the button
  saveBtn.disabled = false;

  // Enable save button only when valid campus selected
  dropdown.addEventListener("change", () => {
    saveBtn.disabled = dropdown.value === "no-campus";
  });
}


function handleImageUpload(event) {
  const file = event.target.files[0];
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const mapImage = document.getElementById("mapImage");
      mapImage.src = e.target.result;
      mapImage.style.display = "block";
      document.getElementById("placeholderText").style.display = "none";
    };
    reader.readAsDataURL(file);
  } else {
    alert("Please select a valid image file.");
  }
}

function signOut() {
  if (confirm("Are you sure you want to sign out?")) {
    // Example action: redirect to login page
    window.location.href = "LoginPage.html"; // Change this to your actual login page
  }
}

</script>

</body>
</html>